# 🎮 明日方舟：永恒回想录

<p align="center">
  <img src="assets/img/ak.png" alt="Game Logo" width="128">
</p>

<p align="center">
  <strong>一款致敬《明日方舟》的高策略度回合制 RPG 网页游戏</strong>
</p>

<p align="center">
  <a href="#-游戏特色">游戏特色</a> •
  <a href="#-快速开始">快速开始</a> •
  <a href="#-干员图鉴">干员图鉴</a> •
  <a href="#-系统介绍">系统介绍</a> •
  <a href="#-技术栈">技术栈</a> •
  <a href="readme_backup/干员排行榜v5.0.md">📊 干员排行榜</a>
</p>

---

## 📖 项目介绍

**明日方舟：永恒回想录** 是一款基于纯前端技术开发的回合制 RPG 游戏，灵感来源于《明日方舟》。游戏不仅完美复刻了干员立绘与技能特色，更创新性地融合了《八方旅人》的 **Break 破盾机制**、Roguelike 无尽挑战以及基于 **TensorFlow.js** 的深度学习 AI 对抗系统。

### ✨ 核心亮点

- ⚔️ **深度战斗** - SPD 行动条、Break 破盾霸体机制、技能连招与元素克制
- 🧠 **SmartAI** - 内置 TensorFlow.js 神经网络，敌人会自我学习并进化策略
- 🏰 **无尽模式** - 随机词缀、Roguelike 强化、SmartTeamBuilder 智能针对性组队
- 🧹 **无尽扫荡** - 基于历史最高层数的极速扫荡，自动计算收益
- 🔮 **召唤系统** - 独特的召唤师职业（如缪尔赛思），支持流形召唤与协同作战
- 🌟 **突破系统** - 6星满潜干员可突破为7星，解锁极限属性或速度特化
- 🎟️ **容错机制** - 复活券原地复活，接力券保存进度
- 🎭 **表现力** - 集成 Pixi.js + Spine，还原精美的 2D 骨骼动画与特效
- 💾 **云/地存档** - 基于 Dexie.js 的 IndexedDB 存储，支持多存档槽位与导入导出

---

## 🚀 快速开始

### 在线试玩

> 🔗 [GitHub Pages 在线试玩](https://xialongxl.github.io/gacha-RPG/)

### 本地运行

由于项目使用了 ES Modules 和 TensorFlow.js，**必须**通过 HTTP 服务器运行（不能直接双击打开 html）。

```bash
# 克隆仓库
git clone https://github.com/xialongxl/gacha-RPG.git

# 进入项目目录
cd gacha-RPG

# 方式1：使用 VSCode (推荐)
# 安装 "Live Server" 插件，右键 index.html 选择 "Open with Live Server"

# 方式2：使用 Python
python -m http.server 8080

# 方式3：使用 Node.js
npx serve .
```

---

## 🎮 游戏特色

### ⚔️ 核心战斗：Break 破盾系统

致敬《八方旅人》的核心战斗机制，极大地提升了策略深度。

*   **护盾 (Shield)**: 精英和 BOSS 拥有护盾层数。
    *   **霸体状态**: 护盾存在时，敌人获得高额减伤，且**免疫眩晕与控制**。
*   **破盾 (BREAK!)**: 通过攻击消耗护盾层数。
    *   普通攻击削减 1 层护盾。
    *   特定技能可削减多层护盾。
*   **Break 状态**: 当护盾归零时触发：
    *   😵 **强制眩晕** 1 回合（打断当前行动）
    *   🛡️ **防御归零**（造成真实伤害）
    *   💥 **受到伤害大幅增加**
    *   🎯 **必定命中**（无视闪避）

### 🧠 SmartAI 深度学习系统

本项目集成了端侧机器学习能力，让高层无尽模式的敌人不再是简单的脚本。

*   **神经网络**: 使用多层感知机 (MLP)，输入层包含 **246 维特征**（敌我双方 HP/能量/属性/Buff/行动条状态/环境信息）。
*   **在线学习**: 游戏实时收集战斗数据，利用 `IndexedDB` 存储经验，自动进行模型训练。
*   **自我评价**: AI 内置评价系统，对每次行动进行评分 (0-5 星)，加速模型收敛。
*   **智能组队**: 在无尽模式 30 层以上，AI 会分析玩家队伍特征（如“高速流”、“奶盾流”），自动生成克制阵容（如针对高速流生成“反伤+减速”队）。

---

## 🔢 核心公式详解

为了帮助硬核玩家更好地规划战术，这里公开游戏的核心数值计算公式。

### 1. 行动条机制 (CTB)

采用基于时间轴的行动逻辑，速度越快，行动频率越高。

*   **行动阈值**: `10000` 点
*   **时间流逝**: 系统会计算最快到达阈值的单位所需时间 `TTA`。
    *   `TTA = (10000 - 当前行动值) / 速度`
*   **行动推进**: 所有单位增加 `速度 × TTA` 的行动值。
*   **行动后**: 行动单位扣除 `10000` 点行动值（保留溢出部分，这意味着超高速单位可能有连续行动的优势）。

### 2. 伤害计算公式

```math
最终伤害 = max(1, (攻击力 × 技能倍率 × 护盾修正 - 防御力 × 0.5) × 暴击修正 × 随机浮动)
```

*   **护盾修正**:
    *   护盾存在 (Shield > 0): **0.5** (50% 减伤)
    *   破盾状态 (Break): **1.0** (且防御力视为 0)
*   **防御力**: 每 2 点防御力抵消 1 点伤害。
*   **暴击修正**: 触发暴击时为 **1.5**。

### 3. 无尽模式成长

随着层数增加，敌人和奖励都会动态成长。

*   **敌人属性**: `基础属性 × (1 + (层数 - 1) × 0.05)`
    *   *例：第 21 层敌人属性为基础的 200%*
*   **奖励数量**: `基础奖励 × (1 + (层数 - 1) × 0.03)`
*   **无尽币产出**: `层数 × 2 + (击败BOSS数量 × 10)`

---

## 📋 干员图鉴

### ⭐⭐⭐⭐⭐⭐ 6 星干员

| 名称 | 职业 | HP | ATK | DEF | SPD | 技能 | 特性 |
|:---|:---:|:---:|:---:|:---:|:---:|:---|:---|
| 阿米娅 | 术师 | 800 | 150 | 60 | 90 | 普攻、奥义·终结、治疗 | - |
| 陈 | 近卫 | 900 | 180 | 70 | 100 | 普攻、赤霄·拔刀、剑雨 | - |
| 银灰 | 近卫 | 850 | 200 | 50 | 85 | 普攻、真银斩、强化 | - |
| 艾雅法拉 | 术师 | 600 | 220 | 40 | 80 | 普攻、二重咏唱、点燃、火山 | 🔥 法术爆发 |
| 凯尔希 | 医疗 | 750 | 160 | 65 | 88 | 普攻、Mon3tr、治疗 | - |
| 铃兰 | 辅助 | 700 | 160 | 55 | 85 | 普攻、全力以赴、儿时的舞乐、狐火渺然 | 👑 超强辅助 |
| 缪尔赛思 | 先锋 | 800 | 150 | 55 | 95 | 普攻、渐进性润化、生态耦合、浅层非熵适应 | 🔮 召唤师 |
| 夜莺 | 医疗 | 750 | 180 | 60 | 80 | 疗愈、治疗强化·γ型、法术护盾、圣域 | 💚 医疗干员 |
| 迷迭香 | 狙击 | 500 | 255 | 60 | 95 | 巨剑投射、思维膨大、末梢阻断、"如你所愿" | ⚡ 余震输出 |

### ⭐⭐⭐⭐⭐ 5 星干员

| 名称 | 职业 | HP | ATK | DEF | SPD | 技能 |
|:---|:---:|:---:|:---:|:---:|:---:|:---|
| 德克萨斯 | 先锋 | 650 | 130 | 55 | 95 | 普攻、剑雨、眩晕 |
| 蓝毒 | 狙击 | 550 | 140 | 45 | 92 | 普攻、毒刺、连射 |
| 白面鸮 | 医疗 | 600 | 100 | 50 | 85 | 普攻、治疗、群疗 |
| 红 | 特种 | 500 | 160 | 35 | 110 | 普攻、处决、潜行 |
| 崖心 | 特种 | 700 | 120 | 60 | 80 | 普攻、钩索、投掷 |

### ⭐⭐⭐⭐ 4 星干员

| 名称 | 职业 | HP | ATK | DEF | SPD | 技能 |
|:---|:---:|:---:|:---:|:---:|:---:|:---|
| 芬 | 先锋 | 500 | 80 | 40 | 75 | 普攻、战吼 |
| 香草 | 先锋 | 450 | 60 | 35 | 70 | 普攻、治疗 |
| 翎羽 | 先锋 | 480 | 90 | 38 | 78 | 普攻、突刺 |
| 玫兰莎 | 近卫 | 520 | 100 | 42 | 82 | 普攻、连斩 |
| 安塞尔 | 医疗 | 400 | 55 | 30 | 72 | 普攻、治疗 |

### ⭐⭐⭐ 3 星干员

| 名称 | 职业 | HP | ATK | DEF | SPD | 技能 |
|:---|:---:|:---:|:---:|:---:|:---:|:---|
| 巡林者 | 狙击 | 350 | 70 | 25 | 70 | 普攻 |
| 杜林 | 医疗 | 300 | 50 | 20 | 65 | 普攻 |
| 夜刀 | 近卫 | 380 | 65 | 28 | 68 | 普攻 |
| 黑角 | 重装 | 400 | 60 | 35 | 60 | 普攻 |
| 12F | 术师 | 320 | 55 | 22 | 62 | 普攻 |

---

## 🎯 技能系统

### 通用技能

| 技能名 | 消耗 | 获取 | 目标 | 效果 |
|:---|:---:|:---:|:---|:---|
| 普攻 | 0 | 30 | 单体 | 造成 100% ATK 伤害，破盾 1 格 |
| 治疗 | 40 | 0 | 友方 | 恢复 150% ATK 生命 |
| 群疗 | 80 | 0 | 全体友方 | 恢复 80% ATK 生命 |
| 战吼 | 50 | 0 | 全体友方 | 全体 ATK +30% |

### 艾雅法拉技能

| 技能名 | 消耗 | 效果 |
|:---|:---:|:---|
| 二重咏唱 | 20 | SPD+60，第2次起额外ATK+60%（可叠加） |
| 点燃 | 50 | 370%单体伤害 + 185%溅射 + 目标DEF-25%(2回合) |
| 火山 | 90 | 自身ATK+130%后随机攻击6个敌人 |

### 铃兰技能

| 技能名 | 消耗 | 效果 |
|:---|:---:|:---|
| 全力以赴 | 20 | 自身ATK+80%，SPD+30 |
| 儿时的舞乐 | 60 | 随机3目标造成160%ATK伤害 |
| 狐火渺然 | 80 | 全队回复20%ATK的HP，敌方全体SPD-30%(2回合) |

### 缪尔赛思技能

| 技能名 | 消耗 | 效果 |
|:---|:---:|:---|
| 渐进性润化 | 30 | 全队+15能量，自身与流形ATK+40%、SPD+20（可叠加） |
| 生态耦合 | 50 | 全队+20能量，自身与流形每回合回血15%(5回合)，流形二连击(3回合)，流形嘲讽(2回合) |
| 浅层非熵适应 | 70 | 全队+25能量，自身与流形ATK+50%，流形攻击附带眩晕(2回合) |

### 夜莺技能

| 技能名 | 消耗 | 效果 |
|:---|:---:|:---|
| 疗愈 | 0(+30) | 治疗选定目标，恢复100%ATK的HP，获得30能量 |
| 治疗强化·γ型 | 30 | 自身ATK+90%（可叠加），大幅提升治疗强度 |
| 法术护盾 | 50 | 全体队友获得护盾(90%ATK)，DEF+20%(3回合) |
| 圣域 | 80 | ATK+80%，疗愈变为全体疗愈，全队闪避+25%、DEF+50%(3回合) |

### 迷迭香技能

| 技能名 | 消耗 | 效果 |
|:---|:---:|:---|
| 巨剑投射 | 0(+30) | 专属普攻：100%ATK伤害 + 余震(50%ATK×N次) |
| 思维膨大 | 20 | 自身ATK+180%（可叠加），超强自增益 |
| 末梢阻断 | 50 | ATK+55%（可叠加），余震+2次叠加，余震范围化，普攻和余震均有20%概率造成眩晕 |
| "如你所愿" | 80 | ATK+75%（可叠加），同时攻击2目标，敌方全体眩晕1回合，且附加DEF-50%(持续2回合) |

---

## 🔮 召唤系统

缪尔赛思等召唤师干员可召唤"流形"作战：

| 配置项 | 数值 |
|:---|:---:|
| 召唤位总数 | 4 |
| 首次召唤数量 | 1 |
| 属性继承比例 | 100% |
| 刷新间隔 | 每 3 次行动 |

### 召唤物特性
- 继承召唤者的基础属性
- 可接收召唤者技能的 Buff 加成
- 召唤者死亡时召唤物消失

### Buff持续时间

| Buff类型 | 持续时间 | 来源技能 |
|:---|:---:|:---|
| ATK%/SPD | 永久 | 渐进性润化 |
| 每回合回血15% | 5回合 | 生态耦合 |
| 二连击 | 3回合 | 生态耦合 |
| 嘲讽 | 2回合 | 生态耦合 |
| 攻击附带眩晕 | 2回合 | 浅层非熵适应 |

---

## 🏰 无尽模式

挑战无尽层数，获取无尽币和时装券！

### 层数奖励
- 🎖️ 每层获得 **2 无尽币**
- 🎖️ 击败 BOSS 额外 **+10 无尽币**
- 🎁 每 **3** 层获得一次强化选择机会

### SmartAI 智能组队
- **30层以上**（非BOSS层）激活智能组队系统
- AI 会分析你的队伍构成（职业、技能），自动生成**针对性**的敌人阵容
- 挑战难度随层数增加而动态提升

### 精英与 BOSS
| 类型 | 出现层数 | 额外词缀 | 保底词缀 |
|:---|:---:|:---:|:---|
| 精英 | 每 5 层 | +1 | 稀有+ |
| BOSS | 每 10 层 | +2 | 传说 |

---

## 🧹 无尽扫荡系统

快速获取资源，无需重复操作。

- **极速扫荡**：每层仅需 1 秒
- **奖励效率**：50% 资源获取
- **每日限制**：免费 3 次，可使用无尽币购买额外次数
- **条件**：需先手动挑战通关至少 1 层

---

## 🛒 无尽币商店

使用无尽币可购买以下道具：

| 道具 | 图标 | 价格 | 效果 |
|:---|:---:|:---:|:---|
| 复活券 | 🎟️ | 1000 无尽币 | 无尽模式全军覆没时可使用，复活全队继续挑战 |
| 接力券 | 🔗 | 800 无尽币 | 战斗胜利后撤退时可记录层数，下次从该层继续 |
| 扫荡次数 | 🧹 | 500 无尽币 | 购买额外的每日扫荡机会 |
| 时装券 | 👗 | 1 无尽币 | 用于购买干员时装 |

### 复活券机制
- 全军覆没时弹出使用提示
- 使用后重新挑战当前层
- 全队满血满状态
- 保留累计奖励

### 接力券机制
- 战斗胜利后撤退时可选择记录层数
- 记录时**不消耗**接力券
- 下次进入无尽模式时可选择使用接力
- **使用接力时**消耗1张接力券
- 从记录层数+1开始挑战

---

## 🔥 词缀系统

无尽模式中敌人会随机获得词缀，增加挑战难度。

### 词缀数量规则

| 层数区间 | 词缀数量 |
|:---:|:---:|
| 1-9 层 | 0 |
| 10-19 层 | 1 |
| 20-29 层 | 2 |
| 30-39 层 | 3 |
| 40-49 层 | 4 |
| 50+ 层 | 5 |

### 普通词缀 (60%)

| 词缀 | 图标 | 效果 |
|:---|:---:|:---|
| 反伤 | 🦔 | 受到攻击时反弹 15% 伤害 |
| 回血 | 💚 | 每回合恢复 5% 最大生命 |
| 狂化 | 😤 | HP 低于 30% 时攻击力 +50% |
| 迅捷 | 💨 | 速度 +15 |
| 坚韧 | 🛡️ | 防御力 +25% |

### 稀有词缀 (30%)

| 词缀 | 图标 | 效果 |
|:---|:---:|:---|
| 连击 | ⚔️ | 普攻时 30% 概率攻击两次 |
| 嘲讽 | 😠 | 强制敌人优先攻击自己 |
| 护盾 | 🔰 | 首次受击伤害减少 50%（一次性） |
| 闪避 | 💫 | 20% 概率闪避攻击 |
| 吸血 | 🩸 | 造成伤害时恢复 15% |

### 传说词缀 (10%)

| 词缀 | 图标 | 效果 |
|:---|:---:|:---|
| 分裂 | 👥 | 死亡时分裂为 2 个小型单位 |
| 爆炸 | 💥 | 死亡时对所有敌人造成 30% 最大 HP 伤害 |
| 不死 | 💀 | 首次致死伤害时恢复 30% HP |
| 强化光环 | ✨ | 队友攻击力 +15% |

---

## 🎲 Roguelike 强化

每过 **3** 层可选择一项强化（原为5层，v6.0优化节奏）：

### 属性强化

| 强化 | 图标 | 效果 |
|:---|:---:|:---|
| 攻击强化 | ⚔️ | 全队攻击 +15% |
| 防御强化 | 🛡️ | 全队防御 +15% |
| 生命强化 | ❤️ | 全队生命 +20% |
| 速度强化 | 💨 | 全队速度 +10 |

### 特殊强化

| 强化 | 图标 | 效果 |
|:---|:---:|:---|
| 暴击强化 | 🎯 | 暴击率 +15% |
| 吸血强化 | 🩸 | 全队 +10% 吸血 |
| 额外生命 | 💖 | 1 次免死金牌 |
| 双倍奖励 | 💰 | 本次挑战奖励 x2 |

### 即时效果

| 强化 | 图标 | 效果 |
|:---|:---:|:---|
| 紧急治疗 | 💚 | 全队恢复 50% HP |
| 复活 | ✨ | 复活 1 个已死亡队友 |
| 能量强化 | ⚡ | 全队能量 +50 |
| 护盾 | 🔰 | 全队获得 20% HP 护盾 |

---

## 📝 版本日志

### v6.0.0 (Current)
*   **重构**: 完整的 Break 破盾机制实装。
*   **新增**: 智能组队系统 (SmartTeamBuilder)，AI 现在懂得针对玩家阵容。
*   **优化**: 文档全面更新，代码结构模块化重构。

### v5.x
*   引入 TensorFlow.js，实装 SmartAI。
*   无尽模式扫荡功能上线。

---

## 🛠️ 技术栈

| 技术 | 用途 |
|:---|:---|
| HTML5 / CSS3 / JavaScript | 核心开发 |
| [Spine](http://esotericsoftware.com/) | 2D 骨骼动画 |
| [PixiJS](https://pixijs.com/) | WebGL 渲染引擎 |
| [pixi-spine](https://github.com/pixijs/spine) | Spine 动画支持 |
| [Dexie.js](https://dexie.org/) | IndexedDB 封装（存档 & SmartAI） |
| [Howler.js](https://howlerjs.com/) | 音频播放 |
| [TensorFlow.js](https://www.tensorflow.org/js) | 深度学习 AI |

---

## 📂 项目结构

```
gacha-RPG/
├── index.html              # 游戏入口
├── manifest.json           # PWA 配置
├── sw.js                   # Service Worker
├── README.md               # 项目说明
│
├── assets/                 # 资源文件
│   ├── art/                # 干员立绘
│   ├── bg/                 # 背景图片
│   ├── bgm/                # 背景音乐
│   ├── img/                # UI 图片
│   ├── skinhead/           # 时装头像
│   └── voice/              # 干员语音
│
├── css/
│   └── style.css           # 样式文件
│
├── js/                     # JavaScript 模块
│   ├── config.js           # 游戏配置（含突破系统配置）
│   ├── data.js             # 干员数据
│   ├── state.js            # 状态管理 & 存档系统
│   │
│   ├── skillCore.js        # 技能系统核心（统一入口）
│   ├── skillData.js        # 技能数据定义
│   ├── skillEffects.js     # 技能效果执行 (含 Break 逻辑)
│   ├── affixSystem.js      # 词缀效果系统
│   ├── chargeSystem.js     # 充能技能系统
│   │
│   ├── battle.js           # 战斗系统
│   ├── battleRenderer.js   # 战斗渲染 (PixiJS)
│   ├── enemyAI.js          # 普通敌人 AI (行为树)
│   │
│   ├── gacha.js            # 抽卡系统
│   ├── team.js             # 队伍管理
│   ├── shop.js             # 商店系统
│   ├── skin.js             # 时装系统
│   ├── summon.js           # 召唤系统
│   │
│   ├── ui.js               # UI 渲染
│   ├── audio.js            # 音频管理
│   ├── cutscene.js         # 演出系统
│   ├── charDetail.js       # 干员详情
│   ├── exchange.js         # 干员兑换
│   ├── glossary.js         # 术语表
│   ├── main.js             # 主逻辑
│   │
│   └── endless_and_smartAI/  # 无尽模式 & SmartAI
│       ├── endless.js              # 无尽模式核心 (Roguelike/扫荡)
│       ├── smartAI.js              # SmartAI 系统 (TensorFlow.js 模型)
│       ├── smartAI_battle.js       # SmartAI 战斗决策接口
│       ├── smartAI_data.js         # SmartAI 数据库 (IndexedDB)
│       ├── smartAI_teamBuilder.js  # 智能组队系统 (针对性生成敌人)
│       └── smartTeam_data.js       # 智能组队数据模板
│
└── lib/                    # 第三方库
    ├── dexie.js            # IndexedDB 封装
    ├── howler.js           # 音频库
    ├── pixi.min.js         # PixiJS
    ├── pixi-spine.umd.js   # Spine 插件
    └── tf.min.js           # TensorFlow.js
```

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📄 许可证

本项目仅供学习交流使用，游戏素材版权归原作者所有。

- 《明日方舟》素材版权归 **上海鹰角网络科技有限公司** 所有
- Spine 动画资源来自 [**PRTS.wiki**](https://prts.wiki/w/%E9%A6%96%E9%A1%B5)

---

## 💬 联系方式

- 📧 项目地址：[https://github.com/xialongxl/gacha-RPG](https://github.com/xialongxl/gacha-RPG)
- 🐛 问题反馈：[Issues](https://github.com/xialongxl/gacha-RPG/issues)

---

<p align="center">
  Made with ❤️ by xialongxl
</p>

<p align="center">
  ⭐ 如果觉得这个项目不错，请给个 Star 支持一下！
</p>
